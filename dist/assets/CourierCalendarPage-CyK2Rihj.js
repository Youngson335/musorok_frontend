import{m as $,b as I,_ as g,o as w,c as b,a as h,f as S,p as k,g as M,N as L,d as C,r as T}from"./index-D5IhssbA.js";const H={data(){return{infoData:null,userID:null,selectedDate:null,workingDays:[],month:new Date().getMonth(),year:new Date().getFullYear(),dataUser:null,infoClickedDate:null}},computed:{...$(["getUserId"])},methods:{showMessage(e,t){I({message:t,type:e,plain:!0})},async updateIntervalInfo(){const e=document.querySelector(".elements__interval");let t=this.selectedDate,a=null,s=null,i=(await(await fetch(`https://musorok.online:8000/courier_schedule/${this.userID}`)).json()).find(n=>n.schedule_dt===t);i&&(i.start_time.slice(0,2)==="9:"?(a="0"+i.start_time.slice(0,1),s=i.end_time.slice(0,2)):(a=i.start_time.slice(0,2),s=i.end_time.slice(0,2)));let c=`${a}:00-${s}:00`;e.innerHTML=`<p>Интервал: ${c}</p>`},async updateIntervalAfterDeletion(){const e=document.querySelector(".elements__interval");this.selectedDate;const t=document.querySelector(".btn__create");e.innerHTML="<p>У вас выходной!</p>",t.innerHTML="<button>Добавить день</button>"},async handleAddDay(){if(this.selectedDate)try{const e=await fetch(`https://musorok.online:8000/add_working_day/${this.userID}`,{method:"POST",headers:{accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({date:this.selectedDate,interval:"09:00-21:00"})});if(!e.ok)throw new Error("Ошибка при выполнении запроса!");const t=document.querySelector(".btn__create"),a=document.querySelector(".elements__interval"),s=await e.json();console.log("День добавлен:",s),this.updateIntervalInfo(),t.innerHTML="",this.showMessage("success","Рабочий день добавлен!"),await this.renderCalendar()}catch(e){console.error("Ошибка при обновлении дня!",e)}},async handleDeleteDay(){if(this.selectedDate)try{const e=await fetch(`https://musorok.online:8000/delete_working_day/${this.userID}`,{method:"DELETE",headers:{accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({date:this.selectedDate})});if(!e.ok)throw new Error("Ошибка при выполнении запроса!");const t=await e.json(),a=document.querySelector(".btn__delete");console.log("День успешно удален!",t),a.innerHTML="",this.updateIntervalAfterDeletion(),this.showMessage("success","День успешно удален!"),await this.renderCalendar()}catch(e){console.error("Ошибка при удалении дня",e)}},async fetchWorkingDays(){const e=this.userID,a=await(await fetch(`https://musorok.online:8000/courier_schedule/${e}`)).json();console.log(a),this.dataUser=a,this.workingDays=a.filter(s=>s.is_working_day===1).map(s=>s.schedule_dt)},async renderCalendar(){const e=document.querySelector(".calendar h3"),t=document.querySelector(".dates");document.querySelector(".info__date");const a=["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],s=new Date(this.year,this.month,1).getDay()||7,o=new Date(this.year,this.month+1,0).getDate(),r=new Date(this.year,this.month,o).getDay(),i=new Date(this.year,this.month,0).getDate();await this.fetchWorkingDays();let c="";for(let n=s-1;n>0;n--)c+=`<li class="inactive">${i-n+1}</li>`;for(let n=1;n<=o;n++){let l="";n===new Date().getDate()&&this.month===new Date().getMonth()&&this.year===new Date().getFullYear()&&(l+=" today activeDay");let m=n<=9?"0"+n:n,u=this.month+1<=9?"0"+(this.month+1):this.month+1,p=`${this.year}-${u}-${m}`;this.workingDays.includes(p)&&(l+=l?" working":"working");let y=l?` class="${l}"`:"";c+=`<li${y}>${n}</li>`}for(let n=r+1;n<7;n++)c+=`<li class="inactive">${n-r}</li>`;t.innerHTML=c,e.textContent=`${a[this.month]} ${this.year}`,t.querySelectorAll("li").forEach(n=>{n.addEventListener("click",l=>{l.target.classList.contains("inactive")||this.handleDateClick(l)})})},handleDateClick(e){const t=document.querySelector(".info__date"),a=document.querySelector(".elements__interval"),s=document.querySelector(".btn__create"),o=document.querySelector(".btn__delete"),r=parseInt(e.target.textContent,10),i=this.month+1,c=this.year;document.querySelectorAll(".activeDay").forEach(_=>_.classList.remove("activeDay")),e.target.classList.add("activeDay");const l=this.getMonthName(this.month).slice(0,-1)+"я";t.innerHTML=`<p>${r} ${l}</p>`,this.selectedDate=`${c}-${String(i).padStart(2,"0")}-${String(r).padStart(2,"0")}`;const m=this.workingDays.find(_=>_===this.selectedDate),u=new Date,p=new Date(u.getFullYear(),u.getMonth(),u.getDate()+4),y=new Date(this.selectedDate);let d=this.dataUser.find(_=>_.schedule_dt===m),f=null,v=null;d?d.start_time.slice(0,2)==="9:"?(f="0"+d.start_time.slice(0,1),v=d.end_time.slice(0,2)):(f=d.start_time.slice(0,2),v=d.end_time.slice(0,2)):d||(a.innerHTML="<p>Выходной день</p>",document.querySelector(".btn__create").addEventListener("click",this.handleAddDay),o.innerHTML="");let D=`${f}:00-${v}:00`;y>p?m?(a.innerHTML=`<p>Интервал: ${D} </p>`,o.innerHTML="<button>Удалить день</button>",o.replaceWith(o.cloneNode(!0)),document.querySelector(".btn__delete").addEventListener("click",this.handleDeleteDay),s.innerHTML=""):(a.innerHTML="<p>У вас выходной!</p>",s.innerHTML="<button>Добавить день</button>",s.replaceWith(s.cloneNode(!0)),document.querySelector(".btn__create").addEventListener("click",this.handleAddDay),o.innerHTML=""):(s.innerHTML="",d!==void 0?a.innerHTML=`<p>Интервал: ${D} </p>`:a.innerHTML="<p>У вас выходной!</p>")},getMonthName(e){return["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"][e]},prevMonth(){this.month===0?(this.year--,this.month=11):this.month--,this.renderCalendar()},nextMonth(){this.month===11?(this.year++,this.month=0):this.month++,this.renderCalendar()}},async mounted(){this.userID=this.getUserId,await this.renderCalendar(),document.getElementById("prev").addEventListener("click",this.prevMonth),document.getElementById("next").addEventListener("click",this.nextMonth)}},q=e=>(k("data-v-3c628f1a"),e=e(),M(),e),E={class:"delivery"},N=S('<div class="calendar" data-v-3c628f1a><header data-v-3c628f1a><h3 data-v-3c628f1a></h3><nav data-v-3c628f1a><button id="prev" data-v-3c628f1a></button><button id="next" data-v-3c628f1a></button></nav></header><section data-v-3c628f1a><ul class="days" data-v-3c628f1a><li data-v-3c628f1a>Пн</li><li data-v-3c628f1a>Вт</li><li data-v-3c628f1a>Ср</li><li data-v-3c628f1a>Чт</li><li data-v-3c628f1a>Пт</li><li data-v-3c628f1a>Сб</li><li data-v-3c628f1a>Вс</li></ul><ul class="dates" data-v-3c628f1a></ul></section></div><div class="info__date" data-v-3c628f1a><p data-v-3c628f1a>Выберите дату</p></div>',2),x={class:"dynamic__еlements"},j=q(()=>h("div",{class:"elements__interval"},null,-1)),A={class:"еlements__btns"};function U(e,t,a,s,o,r){return w(),b("div",E,[N,h("div",x,[j,h("div",A,[h("div",{plain:!0,onClick:t[0]||(t[0]=(...i)=>r.handleDeleteDay&&r.handleDeleteDay(...i)),class:"btn__delete"}),h("div",{plain:!0,onClick:t[1]||(t[1]=(...i)=>r.handleAddDay&&r.handleAddDay(...i)),class:"btn__create"})])])])}const B=g(H,[["render",U],["__scopeId","data-v-3c628f1a"]]),F={components:{NavigationMenu:L,CourierCalendar:B}},O=e=>(k("data-v-5bbb5710"),e=e(),M(),e),W={class:"delivery"},Y=O(()=>h("div",{class:"delivery__title"},[h("h1",null,"Календарь оказания услуг")],-1));function P(e,t,a,s,o,r){const i=T("CourierCalendar");return w(),b("div",W,[Y,C(i)])}const G=g(F,[["render",P],["__scopeId","data-v-5bbb5710"]]);export{G as default};
