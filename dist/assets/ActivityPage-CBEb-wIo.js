import{_ as f,o as c,c as u,F as p,s as k,a as o,t as v,b as C,h as g,v as I,e as m,p as M,g as b,m as A,r as S,u as P,d as D,x as w,y as T,z as $,A as x}from"./index-D5IhssbA.js";const j={data(){return{menu:[{id:0,title:"Новое"},{id:1,title:"В работе"},{id:2,title:"Выполнено"}],deliveryInfoWaiting:null}},props:{newDeliveryWaiting:{type:Object},newDeliveryInProgress:{type:Object},newDeliveryDone:{type:Object}},watch:{newDeliveryWaiting(){this.updateMenuData()},newDeliveryInProgress(){this.updateMenuData()},newDeliveryDone(){this.updateMenuData()}},methods:{updateMenuData(){this.newDeliveryWaiting&&this.newDeliveryInProgress&&this.newDeliveryDone&&(this.menu[0].delivery=this.newDeliveryWaiting,this.menu[1].delivery=this.newDeliveryInProgress,this.menu[2].delivery=this.newDeliveryDone,this.selectedOptions(0))},selectedOptions(e){document.querySelectorAll(".options-button").forEach((i,s)=>{s===e?i.classList.add("active__options"):i.classList.remove("active__options")}),this.$nextTick(()=>{let i=this.menu[e];if(i&&i.delivery){let s=i.delivery.value;console.log(s),this.$emit("updateDelivery",s)}else console.log("Доставка не найдена",e)}),console.log(this.menu[e])}},mounted(){this.updateMenuData()}},L={class:"activity__options"},q=["onClick"];function B(e,n,i,s,a,l){return c(),u("section",L,[(c(!0),u(p,null,k(a.menu,r=>(c(),u("div",{class:"options",key:r.id},[o("button",{class:"options-button",onClick:h=>l.selectedOptions(r.id)},v(r.title),9,q)]))),128))])}const U=f(j,[["render",B],["__scopeId","data-v-0e970c5d"]]),V={data(){return{infoDelivery:this.clickedInfoUser,activeId:null}},props:{clickedInfoUser:{type:Object,required:!0},stateModal:{type:Boolean}},computed:{checkInfoUser(){return this.clickedInfoUser},checkId(){return this.clickedInfoUser.clickedInfo.id}},methods:{open2(){C({message:"Вы взялись за заказ!",type:"success"})},toHome(){this.$emit("editStateModal",!1),this.$emit("updateData",!0)},async changeStatus(e){let n=String(e);console.log("итоговый id",{id:n}),console.log(e),await fetch("https://musorok.online:8000/update_delivery_in_progress/",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({id:n})}).then(s=>{if(s.ok)return s;throw new Error("Ошибка при отправке данных")}).then(s=>{console.log("Обновил статус: ",s),this.$emit("updateStateModal",!1),this.open2()}).catch(s=>{console.error("Произошла ошибка: ",s)})}}},E=e=>(M("data-v-f3e272cb"),e=e(),b(),e),F={class:"modal__delivery"},z={class:"info__id"},N={class:"exit"},H=E(()=>o("span",null,[o("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[o("path",{fill:"currentColor",d:"M529.408 149.376a29.12 29.12 0 0 1 41.728 0 30.592 30.592 0 0 1 0 42.688L259.264 511.936l311.872 319.936a30.592 30.592 0 0 1-.512 43.264 29.12 29.12 0 0 1-41.216-.512L197.76 534.272a32 32 0 0 1 0-44.672l331.648-340.224zm256 0a29.12 29.12 0 0 1 41.728 0 30.592 30.592 0 0 1 0 42.688L515.264 511.936l311.872 319.936a30.592 30.592 0 0 1-.512 43.264 29.12 29.12 0 0 1-41.216-.512L453.76 534.272a32 32 0 0 1 0-44.672l331.648-340.224z"})])],-1)),J=[H],G={class:"info__comment"},R={class:"detail__info"},Y={class:"info__task"},K={class:"info__address"},Q={class:"info__name"},X={class:"in__working"};function Z(e,n,i,s,a,l){return g((c(),u("div",F,[(c(!0),u(p,null,k(l.checkInfoUser,r=>(c(),u("div",{class:"all__info",key:r.id},[o("div",z,[o("div",N,[o("button",{onClick:n[0]||(n[0]=(...h)=>l.toHome&&l.toHome(...h))},J)]),o("p",null,"ID: "+v(r.id),1)]),o("div",G,[o("p",null,v(r.comment),1)]),o("div",R,[o("div",Y,[o("p",null,[m(" Задание: "),o("span",null,v(r.meeting_name),1)])]),o("div",K,[o("p",null,[m(" Адрес: "),o("span",null,v(r.full_adress),1)])]),o("div",Q,[o("p",null,[m(" Клиент: "),o("span",null,v(r.client_name),1)])])])]))),128)),o("div",X,[o("button",{plain:!0,onClick:n[1]||(n[1]=r=>l.changeStatus(l.checkId))}," Взять в работу! ")])],512)),[[I,i.stateModal]])}const ee=f(V,[["render",Z],["__scopeId","data-v-f3e272cb"]]),te={components:{ModalInfoDeliveryAgent:ee},data(){return{date:null,infoDelivery:null,showInfoDelivery:!0,clickedInfoUser:{},stateModal:!1,loading:!0,showWarning:!1}},props:{selectedDate:{type:String},reDelivery:{type:Object}},watch:{selectedDate(e){this.date=e,this.checkUserId()},reDelivery(){this.reDelivery[0]?this.showWarning=!1:this.showWarning=!0}},computed:{...A(["getUserId"])},methods:{updateStateModal(e){this.stateModal=e,this.getDeliveryAgentOrdersById(this.getUserId,this.date)},updateData(e){e===!0?(console.log("обновил"),this.getDeliveryAgentOrdersById(this.getUserId,this.date)):console.log("не обновил")},editStateModal(e){this.stateModal=e},getValueFromProxy(e){this.stateModal=!0;const i=this.infoDelivery.find(s=>s.id===e);this.clickedInfoUser.clickedInfo=i,console.log(this.clickedInfoUser)},checkUserId(){this.date!==""?(console.log("получил",this.date),this.getDeliveryAgentOrdersById(this.getUserId,this.date)):console.log("ничего не отправил!")},async getDeliveryAgentOrdersById(e,n){console.log({newDate:n,newId:e}),this.loading=!0;try{const s=await fetch(`https://musorok.online:8000/delivery_agent_orders/${e}`,{method:"POST",headers:{accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({order_date:n})});if(!s.ok)throw new Error("Ошибка при отправке данных");const a=await s.json();console.log("Данные отправлены!",a);let l=a.filter(t=>t.meeting_status==="In progress"),r=a.filter(t=>t.meeting_status==="Waiting"),h=a.filter(t=>t.meeting_status==="Done");this.deliveryInProgress=l,this.$emit("deliveryWaiting",r),this.$emit("deliveryInProgress",l),this.$emit("deliveryInfoDone",h),this.infoDelivery=a,this.showInfoDelivery=!0,this.loading=!1,this.infoDelivery.forEach((t,d)=>{setTimeout(()=>{const _=document.querySelectorAll(".block__order");_[d].style.animationDelay=`${d*.1}s`},d*100)})}catch(s){console.error("Произошла ошибка: ",s)}}},mounted(){this.date=this.selectedDate,this.checkUserId}},oe=e=>(M("data-v-92b360cf"),e=e(),b(),e),ne={class:"load"},se={class:"orders__block"},ie=["onClick"],ae={class:"order__interval"},le={class:"interval__start"},re={class:"interval__end"},de={class:"order__client"},ce={class:"client__name"},ue={class:"client__address"},_e={class:"showWarning"},he=oe(()=>o("p",null,"Нет заказов",-1)),ve=[he];function ye(e,n,i,s,a,l){const r=S("ModalInfoDeliveryAgent"),h=P("loading");return c(),u(p,null,[g((c(),u("div",ne,[(c(!0),u(p,null,k(i.reDelivery,t=>g((c(),u("div",se,[o("div",{class:"block__order",onClick:d=>l.getValueFromProxy(t.id)},[o("div",ae,[o("div",le,v(t.start_time),1),o("div",re,v(t.end_time),1)]),o("div",de,[o("div",ce,[o("p",null,v(t.client_name),1)]),o("div",ue,[o("p",null,v(t.full_adress),1)])])],8,ie)],512)),[[I,a.showInfoDelivery]])),256))])),[[h,a.loading]]),g(o("div",_e,ve,512),[[I,a.showWarning]]),D(r,{clickedInfoUser:a.clickedInfoUser,stateModal:a.stateModal,onEditStateModal:l.editStateModal,onUpdateData:l.updateData,onUpdateStateModal:l.updateStateModal},null,8,["clickedInfoUser","stateModal","onEditStateModal","onUpdateData","onUpdateStateModal"])],64)}const W=f(te,[["render",ye],["__scopeId","data-v-92b360cf"]]),ge={class:"demo-date-picker"},De={class:"block"},pe={data(){return{loadPage:!1,newDeliveryWaiting:null,newDeliveryInProgress:null,newDeliveryDone:null,reDelivery:null}},components:{ActivityMenu:U,DeliveryAgentOrders:W},methods:{updateValueDelivery(e){this.reDelivery=e},loadPage(){console.log("отработал"),this.$emit("loadingPage",!1)},addDeliveryWaiting(e){const n={status:"Ожидание",value:e};this.newDeliveryWaiting=n,console.log(n)},addDeliveryInProgress(e){const n={status:"В процессе",value:e};this.newDeliveryInProgress=n,console.log(n)},addDeliveryDone(e){const n={status:"Завершил",value:e};this.newDeliveryDone=n,console.log(n)}},mounted(){const e=document.querySelector('th[aria-label="Sunday"]'),n=document.querySelector('th[aria-label="Monday"]'),i=document.querySelector('th[aria-label="Tuesday"]'),s=document.querySelector('th[aria-label="Wednesday"]'),a=document.querySelector('th[aria-label="Thursday"]'),l=document.querySelector('th[aria-label="Friday"]'),r=document.querySelector('th[aria-label="Saturday"]');e?(e.textContent="Пн",n.textContent="Вт",i.textContent="Ср",s.textContent="Чт",a.textContent="Птн",l.textContent="Сб",r.textContent="Вс"):console.error('Элемент с aria-label="Sunday" не найден.')}},fe=Object.assign(pe,{__name:"SelectedDate",setup(e){const n=w("default"),i=w(""),s=w(""),a=t=>{if(!t)return"";const d=new Date(t),_=d.getFullYear(),y=`0${d.getMonth()+1}`.slice(-2),O=`0${d.getDate()}`.slice(-2);return`${_}-${y}-${O}`},l=t=>{const d=new Date,_=new Date(d);_.setDate(d.getDate()+1);const y=new Date(_);return y.setHours(23,59,59,999),t<=y};T(i,t=>{const d=new Date(t);l(d)?(s.value=a(t),console.log(s.value)):(console.error("Выбранная дата за пределами допустимого диапазона."),i.value="")});const r=t=>{const d=new Date,_=new Date(d);return _.setDate(d.getDate()+1),t.getTime()>_.getTime()},h=()=>{const{emit:t}=x();t("loadingPage",!1)};return $(()=>{h()}),$(()=>{const t=new Date;i.value=a(t)}),(t,d)=>{const _=S("el-date-picker");return c(),u(p,null,[o("div",ge,[o("div",De,[D(_,{modelValue:i.value,"onUpdate:modelValue":d[0]||(d[0]=y=>i.value=y),type:"date",placeholder:"Выберите дату!",size:n.value,"disabled-date":r},null,8,["modelValue","size"])])]),D(U,{newDeliveryWaiting:t.newDeliveryWaiting,newDeliveryInProgress:t.newDeliveryInProgress,newDeliveryDone:t.newDeliveryDone,onUpdateDelivery:t.updateValueDelivery},null,8,["newDeliveryWaiting","newDeliveryInProgress","newDeliveryDone","onUpdateDelivery"]),D(W,{onDeliveryWaiting:t.addDeliveryWaiting,onDeliveryInProgress:t.addDeliveryInProgress,onDeliveryInfoDone:t.addDeliveryDone,selectedDate:s.value,reDelivery:t.reDelivery},null,8,["onDeliveryWaiting","onDeliveryInProgress","onDeliveryInfoDone","selectedDate","reDelivery"])],64)}}}),me=f(fe,[["__scopeId","data-v-9ae1de0e"]]),we={components:{SelectedDate:me},data(){return{loading:!0,reload:null}},methods:{editLoading(e){this.loading=e}}},Ie={class:"activity__page"};function ke(e,n,i,s,a,l){const r=S("SelectedDate"),h=P("loading");return g((c(),u("div",Ie,[D(r,{onLoadingPage:l.editLoading},null,8,["onLoadingPage"])])),[[h,a.loading]])}const $e=f(we,[["render",ke],["__scopeId","data-v-5a52cd08"]]);export{$e as default};
